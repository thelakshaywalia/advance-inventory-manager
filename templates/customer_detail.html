{% extends "base.html" %}
{% block title %}Customer: {{ customer.name }}{% endblock %}

{% block content %}
    <div class="page-header">
        <h1>ðŸ‘¥ {{ customer.name }} Details</h1>
    </div>

    <section class="customer-info-card">
        <h2>Contact & Credit</h2>
        <p><strong>Phone:</strong> {{ customer.phone }}</p>
        <p><strong>Email:</strong> {{ customer.email or 'N/A' }}</p>
        <p><strong>Address:</strong> {{ customer.address or 'N/A' }}</p>
        <p><strong>Outstanding Credit:</strong> <span class="data-value {% if credit_due > 0 %}red{% else %}green{% endif %}">{{ credit_due | currency }}</span></p>

        <form method="POST" action="{{ url_for('record_payment', customer_id=customer.id) }}" style="margin-top: 15px;">
            <label for="payment_amount">Record Payment Received:</label>
            <input type="number" id="payment_amount" name="payment_amount" 
                   placeholder="Amount (e.g., 500.00)" step="0.01" min="0.01" required 
                   style="width: 200px; display: inline;">
            
            <button type="submit" class="btn-checkout" style="width: auto; margin-left: 10px; margin-top: 0;">Record Payment</button>
        </form>
    </section>

    <section class="history-table" style="margin-top: 30px;">
        <h2>Purchase History</h2>
        {% if history %}
            <table>
                <thead>
                    <tr>
                        <th>Date/Time</th>
                        <th>Transaction ID</th>
                        <th>Total Amount</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for transaction in history %}
                    <tr class="{% if transaction.status == 'Payment' %}payment-row{% elif transaction.status == 'Credit' %}credit-row{% endif %}">
                        <td>{{ transaction.timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>#{{ transaction.id }}</td>
                        <td>
                            {% if transaction.status == 'Payment' %}
                                <span style="color: green; font-weight: bold;">{{ transaction.total_amount | currency }} (Paid)</span>
                            {% elif transaction.status == 'Credit' %}
                                <span style="color: red; font-weight: bold;">{{ transaction.total_amount | currency }} (Due)</span>
                            {% else %}
                                {{ transaction.total_amount | currency }}
                            {% endif %}
                        </td>
                        <td>{{ transaction.status }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No purchase history for this customer.</p>
        {% endif %}
    </section>
{% endblock %}